I"Ç<p>æœ€è¿‘ç ”ç©¶äº†ä¸€ä¸‹Javaè™šæ‹Ÿæœºçš„å†…å­˜ç®¡ç†ã€‚</p>

<p>å¤§ä½“ä¸Šåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šåƒåœ¾å›æ”¶ç®—æ³•å’Œå†…å­˜åˆ†é…ã€‚ä¸¾ä¸ªä¸æ°å½“çš„æ¯”å–»ï¼Œå¥½æ¯”æ±½è½¦çš„å˜é€Ÿç®±å’Œå‘åŠ¨æœºã€‚å½“â€™è½¬é€Ÿ/å†…å­˜ä½¿ç”¨â€™åé«˜æ—¶ï¼Œå°±ä¼šè§¦å‘â€™æ¢æŒ¡/åƒåœ¾å›æ”¶â€™ã€‚</p>

<p>Javaè™šæ‹Ÿæœºçš„å†…å­˜åˆ†é…ï¼Œå¤§ä½“ä¸Šå¯åˆ†ä¸ºå¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼Œè€å¹´ä»£ï¼ˆTenured Generationï¼‰ä»¥åŠå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ã€‚å…¶ä¸­ï¼Œæ–°ç”Ÿä»£åˆåˆ†ä¸ºEdenï¼ˆä¼Šç”¸å›­ï¼‰,S0å’ŒS1ï¼ˆSurvivorï¼Œå¹¸å­˜è€…ä¹å›­ï¼‰ã€‚ï¼ˆå‚è€ƒã€ŠJavaç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“ã€‹åŠVisualVMï¼‰</p>

<p>æ³¨ï¼šJava 8å–æ¶ˆäº†åŸæ¥çš„æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ï¼Œæ”¹ä¸ºå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰äº†ã€‚</p>

<p>å¯¹åº”äºJavaè™šæ‹Ÿæœºçš„å‚æ•°è®¾ç½®ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-Xmnçš„å¤§å° = Eden + S0 + S1
-Xmxçš„å¤§å° = Eden + S0 + S1 + Old
-XX:SurvivorRatioç”¨æ¥åˆ†é…Edenå’ŒSçš„æ¯”ä¾‹
-XX:MaxMetaspaceSizeè¡¨ç¤ºMetaspaceçš„æœ€å¤§å€¼ï¼ˆ-XX:MaxPermSizeåœ¨Java 8ç§å·²ç»æ²¡ç”¨äº†ï¼‰
</code></pre></div></div>

<p>æ‰€ä»¥Xmnçš„å¤§å°ä¸èƒ½è¶…è¿‡Xmxï¼Œè€Œä¸”æœ€å¥½ä¹Ÿä¸è¦ç›¸ç­‰ï¼Œå¦åˆ™Oldç©ºé—´å°±å˜æˆ0äº†ã€‚æœ‰äº›ä¹¦ä¸Šè¯´SurvivorRatioçš„é»˜è®¤å€¼ä¸º8:1:1ï¼Œä½†æ˜¯ç›®æµ‹Java 8é‡Œé¢çš„é»˜è®¤å€¼ä¸º1:1:1</p>

<p>é€šè¿‡VisualVMå¯ä»¥å¾ˆç›´è§‚åœ°è§‚å¯Ÿä¸Šé¢çš„æ”¹åŠ¨ã€‚</p>

<p><img src="http://tengrui.github.io/public/upload/visualvm.jpg" alt="press" /></p>

<p>ä»¥è§‚å¯ŸEclipseçš„å¯åŠ¨æ—¶é—´ä¸ºä¾‹ï¼Œéœ€è¦ä¸æ–­åœ°ä¿®æ”¹Eclipseçš„é…ç½®æ–‡ä»¶ï¼Œå¹¶é‡å¯Eclipseï¼Œæ“ä½œç³»ç»Ÿéƒ½å¿«è¢«æˆ‘ç©åäº†ã€‚ä¸è¿‡ç›®å‰VisualVMä¹Ÿæœ‰Bugï¼ŒMetaspaceçš„æœ€å¤§å€¼å¥½åƒä¸€ç›´æ˜¯1Gå·¦å³ï¼Œæœ€ç»ˆæˆ‘æŠŠMaxMetaspaceSizeæ”¹ä¸º20mï¼ŒEclipseå¯åŠ¨å‡ºé”™ï¼Œè¯´æ˜è¿™ä¸ªå‚æ•°æ˜¯èµ·ä½œç”¨çš„ï¼Œä»è€Œè¯æ˜äº†VisualVMå­˜åœ¨Bugã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!SESSION 2015-04-07 20:49:06.963 -----------------------------------------------
eclipse.buildId=4.3.2.M20140221-1700
java.version=1.8.0_25
java.vendor=Oracle Corporation
BootLoader constants: OS=win32, ARCH=x86_64, WS=win32, NL=en_US
Framework arguments:  -product org.eclipse.epp.package.standard.product
Command-line arguments:  -os win32 -ws win32 -arch x86_64 -product org.eclipse.epp.package.standard.product

This is a continuation of log file D:\01_Programming\01_Java\workspace\.metadata\.bak_0.log
Created Time: 2015-04-07 20:49:40.681

!ENTRY org.eclipse.ui 4 0 2015-04-07 20:49:40.697
!MESSAGE Unhandled event loop exception
!STACK 0
org.eclipse.swt.SWTException: Failed to execute runnable (java.lang.OutOfMemoryError: Metaspace)
	at org.eclipse.swt.SWT.error(SWT.java:4397)
	at org.eclipse.swt.SWT.error(SWT.java:4312)
	at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:138)
	at org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:4145)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3762)
	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine$9.run(PartRenderingEngine.java:1113)
	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine.run(PartRenderingEngine.java:997)
	at org.eclipse.e4.ui.internal.workbench.E4Workbench.createAndRunUI(E4Workbench.java:140)
	at org.eclipse.ui.internal.Workbench$5.run(Workbench.java:611)
	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:567)
	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:150)
	at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:124)
	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:196)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:354)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:181)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
	at java.lang.reflect.Method.invoke(Unknown Source)
	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:636)
	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:591)
	at org.eclipse.equinox.launcher.Main.run(Main.java:1450)
Caused by: java.lang.OutOfMemoryError: Metaspace
</code></pre></div></div>

<p>å…¶å®æˆ‘æœ¬æ¥æ˜¯æƒ³è°ƒä¼˜çš„ï¼Œä½†æ˜¯Windows 7 64ä½ç¯å¢ƒä¸Šï¼Œæ— è®ºæ€ä¹ˆè°ƒæ•´å‚æ•°ï¼Œæœ€åçš„å¯åŠ¨æ—¶é—´éƒ½æ˜¯6ã€7ç§’çš„æ ·å­ï¼Œæ‰€ä»¥æœ€ååªèƒ½å˜æˆè°ƒâ€åŠ£â€äº†ã€‚ï¼ˆä¸‹å›¾ä¸ºã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸­æµ‹é‡å¯åŠ¨æ—¶é—´çš„Eclipseæ’ä»¶ï¼‰</p>

<p><img src="http://tengrui.github.io/public/upload/startup.jpg" alt="press" /></p>

<p>ç»“è®ºï¼š</p>

<ol>
  <li>Javaè™šæ‹Ÿæœºçš„å†…å­˜ç®¡ç†æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆå¤æ‚ï¼Œå¦‚æœç»“åˆVisualVMè¿™ç§å·¥å…·æ¥å­¦ä¹ ï¼Œèƒ½èµ·åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚</li>
  <li>Javaå†…å­˜ç©ºé—´æœ‰æ—¶è¿˜æ˜¯æŒºæµªè´¹çš„ï¼Œå°¤å…¶æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼ŒSurvivorRatioæ¯”ä¾‹ä¸º1:1:1çš„æƒ…å†µä¸‹ï¼Œå¤§æ¦‚æœ‰ä¸‰åˆ†ä¹‹ä¸€çš„ç©ºé—´ä¸€ç›´ä¸ºç©ºã€‚</li>
  <li>å…³äºJVMå†…å­˜å‚æ•°çš„è®¾å®šè¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå°¤å…¶æƒ³ææ¸…æ¥šä¸€äº›é—®é¢˜ï¼Œå¸Œæœ›å°½å¿«é‡ç°çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‰éœ€æ±‚ä¿®æ”¹ç©ºé—´å¤§å°ï¼Œè¾¾åˆ°å¿«é€ŸæŠŠäº‹æƒ…æç ¸çš„ç›®çš„ã€‚</li>
</ol>
:ET