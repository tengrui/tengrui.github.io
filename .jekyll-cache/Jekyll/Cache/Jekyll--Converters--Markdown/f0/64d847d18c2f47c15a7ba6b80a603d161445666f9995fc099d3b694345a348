I"½<p>æœ€åˆè§åˆ°è¿™ä¸ªé—®é¢˜æ˜¯åœ¨ã€Šæˆ‘ç¼–ç¨‹ï¼Œæˆ‘å¿«ä¹â€”â€”ç¨‹åºå‘˜èŒä¸šè§„åˆ’ä¹‹é“ã€‹ä¸Šï¼Œæˆ‘çš„ç¬¬ä¸€ååº”æ˜¯æ„é€ ä¸€ä¸ªOutOfMemoryErroræˆ–è€…StackOverflowErrorã€‚ä¸ºäº†å¿«é€Ÿäº§ç”Ÿç»“æœï¼Œåœ¨JVMå‚æ•°è¿›è¡Œå¦‚ä¸‹è®¾ç½®åï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-verbose:gc -Xms20M -Xmx20M -Xmn10M -XX:+PrintGCDetails -XX:SurvivorRatio=8
</code></pre></div></div>

<p>ä¸‹é¢çš„ä»£ç å³å¯å¾ˆå¿«äº§ç”ŸOutOfMemoryErrorï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import java.util.ArrayList;
import java.util.List;

public class Crash {
    public static void main(String[] args) {
        List&lt;Object&gt; list = new ArrayList&lt;Object&gt;();
    
        while(true) {
            list.add(new Object());
        }
    }
}
</code></pre></div></div>

<p>è¾“å‡ºæ•ˆæœ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[GC (Allocation Failure) [PSYoungGen: 7330K-&gt;992K(9216K)] 7330K-&gt;5297K(19456K), 0.0094021 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] 
[GC (Allocation Failure) --[PSYoungGen: 9184K-&gt;9184K(9216K)] 13489K-&gt;19416K(19456K), 0.0171858 secs] [Times: user=0.06 sys=0.00, real=0.02 secs] 
[Full GC (Ergonomics) [PSYoungGen: 9184K-&gt;0K(9216K)] [ParOldGen: 10232K-&gt;9893K(10240K)] 19416K-&gt;9893K(19456K), [Metaspace: 2524K-&gt;2524K(1056768K)], 0.1437797 secs] [Times: user=0.23 sys=0.00, real=0.14 secs] 
[Full GC (Ergonomics) [PSYoungGen: 7706K-&gt;8077K(9216K)] [ParOldGen: 9893K-&gt;7783K(10240K)] 17600K-&gt;15860K(19456K), [Metaspace: 2524K-&gt;2524K(1056768K)], 0.1274782 secs] [Times: user=0.25 sys=0.00, real=0.13 secs] 
[Full GC (Allocation Failure) [PSYoungGen: 8077K-&gt;8076K(9216K)] [ParOldGen: 7783K-&gt;7783K(10240K)] 15860K-&gt;15859K(19456K), [Metaspace: 2524K-&gt;2524K(1056768K)], 0.0685814 secs] [Times: user=0.16 sys=0.00, real=0.07 secs] 
Exception in thread "main" java.lang.OutOfMemoryError: Java heap space
	at java.util.Arrays.copyOf(Arrays.java:3210)
	at java.util.Arrays.copyOf(Arrays.java:3181)
	at java.util.ArrayList.grow(ArrayList.java:261)
	at java.util.ArrayList.ensureExplicitCapacity(ArrayList.java:235)
	at java.util.ArrayList.ensureCapacityInternal(ArrayList.java:227)
	at java.util.ArrayList.add(ArrayList.java:458)
	at Demo.main(Demo.java:9)
[Full GC (Ergonomics) [PSYoungGen: 8192K-&gt;0K(9216K)] [ParOldGen: 7783K-&gt;492K(10240K)] 15975K-&gt;492K(19456K), [Metaspace: 2550K-&gt;2550K(1056768K)], 0.0036032 secs] [Times: user=0.06 sys=0.00, real=0.00 secs] 
Heap
 PSYoungGen      total 9216K, used 164K [0x00000000ff600000, 0x0000000100000000, 0x0000000100000000)
  eden space 8192K, 2% used [0x00000000ff600000,0x00000000ff6290e8,0x00000000ffe00000)
  from space 1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)
  to   space 1024K, 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)
 ParOldGen       total 10240K, used 492K [0x00000000fec00000, 0x00000000ff600000, 0x00000000ff600000)
  object space 10240K, 4% used [0x00000000fec00000,0x00000000fec7b000,0x00000000ff600000)
 Metaspace       used 2557K, capacity 4486K, committed 4864K, reserved 1056768K
  class space    used 275K, capacity 386K, committed 512K, reserved 1048576K
</code></pre></div></div>

<p>è‡³äºäº§ç”ŸStackOverflowErrorï¼Œä¸€ä¸ªæ²¡æœ‰è¿”å›çš„é€’å½’å‡½æ•°å³å¯å®ç°ã€‚</p>

<p>ä½†ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™äº›å¹¶æ²¡æœ‰è®©JVMå´©æºƒï¼Œè€Œæ˜¯æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼ŒJavaè™šæ‹Ÿæœºè§„èŒƒé‡Œé¢å·²ç»æ˜ç¡®å®šä¹‰äº†è¿™äº›å¼‚å¸¸å‘ç”Ÿçš„æƒ…å†µã€‚</p>

<p>åœ¨çœŸæ­£çš„é»‘å®¢çœ¼é‡Œï¼ŒJVMå†…éƒ¨çš„Bugæ‰æ˜¯ä»–ä»¬çš„ç­”æ¡ˆã€‚ä½†JVMå†…éƒ¨çš„Bugæœ€ç»ˆä¼šè¢«ä¿®å¤ï¼Œå¯¹äºä¸€èˆ¬çˆ±å¥½è€…ï¼Œå¯ä»¥æ‰¾æ‰¾ä»¥å‰çš„Java Bug Databaseï¼Œç„¶åç”¨æ—§ç‰ˆæœ¬çš„JVMéªŒè¯ã€‚</p>

<p>ä¸è¿‡è¿˜æœ‰å¦å¤–ä¸€ç§å®¹æ˜“å¼•èµ·JVMå´©æºƒçš„åœ°æ–¹å°±æ˜¯JNIï¼Œè™½ç„¶æ˜¯å¤–éƒ¨ä»£ç å¼•èµ·çš„ï¼Œä½†åº”è¯¥ä¹Ÿç®—æ˜¯JVMæœºåˆ¶ä¸Šçš„ä¸€ç§ç¼ºé™·å§ã€‚</p>

<p>ä»¥ä¸‹æ¼”ç¤ºä¸€ä¸‹JNIå¯¼è‡´Javaè™šæ‹Ÿæœºå´©æºƒçš„ä¾‹å­ã€‚è¯­æ–‡å­¦å¾—ä¸å¥½ï¼Œç›´æ¥ä¸Šä»£ç ï¼š</p>

<p>JvmCrash.java</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class JvmCrash
{
	public static native void greeting();
}
</code></pre></div></div>

<p>JvmCrashTest.java</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class JvmCrashTest
{
	public static void main(String[] args)
	{
		JvmCrash.greeting();
	}
	static
	{
		System.loadLibrary("JvmCrash");
	}
}
</code></pre></div></div>

<p>JvmCrash.h (ç”±javahå·¥å…·è‡ªåŠ¨ç”Ÿæˆçš„)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/* DO NOT EDIT THIS FILE - it is machine generated */
#include &lt;jni.h&gt;
/* Header for class JvmCrash */

#ifndef _Included_JvmCrash
#define _Included_JvmCrash
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     JvmCrash
 * Method:    greeting
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_JvmCrash_greeting
  (JNIEnv *, jclass);

#ifdef __cplusplus
}
#endif
#endif
</code></pre></div></div>

<p>JvmCrash.c</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "JvmCrash.h"
#include &lt;stdio.h&gt;

JNIEXPORT void JNICALL Java_JvmCrash_greeting(JNIEnv* env, jclass cl)
{
	printf("Hello Crash World!\n");
    int i = 0;
    int j = 1 / i;
}
</code></pre></div></div>

<p>ç„¶åï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°ä¸€ä¸ªFatal Errorè€Œä¸æ˜¯ä¸€ä¸ªExceptionäº†ï¼</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#
# A fatal error has been detected by the Java Runtime Environment:
#
#  EXCEPTION_INT_DIVIDE_BY_ZERO (0xc0000094) at pc=0x10001020, pid=2388, tid=4988
#
# JRE version: Java(TM) SE Runtime Environment (8.0_40-b26) (build 1.8.0_40-b26)
# Java VM: Java HotSpot(TM) Client VM (25.40-b25 mixed mode, sharing windows-x86 )
# Problematic frame:
# C  [JvmCrash.dll+0x1020]
#
# Failed to write core dump. Minidumps are not enabled by default on client versions of Windows
#
# An error report file with more information is saved as:
# C:\Documents and Settings\Administrator\workspace\JNICrash\hs_err_pid2388.log
#
# If you would like to submit a bug report, please visit:
#   http://bugreport.java.com/bugreport/crash.jsp
# The crash happened outside the Java Virtual Machine in native code.
# See problematic frame for where to report the bug.
#
Hello Crash World!
</code></pre></div></div>
:ET